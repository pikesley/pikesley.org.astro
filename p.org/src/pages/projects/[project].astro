---
import Base from "../../layouts/Base.astro";
import Projects from "../../data/projects.json";

import { marked } from "marked";

export function getStaticPaths() {
  return Projects.map((proj) => {
    return {
      params: { project: proj.name },
      props: { proj },
    };
  });
}

const { proj } = Astro.props;

// https://stackoverflow.com/a/40403285
const readme = await fetch(
  `https://api.github.com/repos/${proj.github}/readme`,
  {
    headers: {
      Accept: "application/vnd.github+json",
    },
  }
)
  .then(function (response) {
    return response.json();
  })
  .then(function (data) {
    return data;
  });

// https://docs.astro.build/en/guides/markdown-content/#fetching-remote-markdown
const markdown = marked.parse(atob(readme.content));
---

<Base>
  <div set:html={markdown} />
</Base>
